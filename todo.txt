A bit of network programming in c#.

Goal: Implement 4 player multi-player for Galaxy Forces VR
*Requirements from you
- You will need min two windows PCs in a network for testing
- You will need to be familiar with TcpListener and TcpCliend in C#
- You will need some knowledge of Unity
- You will need to download the "Galaxy Forces VR" Unity project and make sure you can run it and debug it.
 (that is a first test order of $20, then we can continue with the real order if you believe you can help me)
*Current status of project
- Unity and C# is used, PC windows.
- Game is single player and in a mature state.
- Open.Nat library is used to setup port forwarding with UPnP.
- PHP database is used in the Create/Join procedure:
(mpgames_create.php accessed when a game is created, and then continuously access it every 30 sec while the game is waiting for joining players)
(mpgames_join.php accessed to get a list of all games created that are waiting for players)
- SendRecv.cs will contain the new code, and contains a first version.
- GUI for the connection procedure is partly done, I will continue on this.
- It is a VR game but it runs without VR with mouse and keyboard, SteamVR is needed.
*TODO
1. Connect/Join/Cancel code to go through firewall/router (internet/local side)
It is possible to implement this with C# tcp sockets and is well on the way.
- SendRecv.cs and GameManager.cs (and Menu.cs) source files are the only files needed to modify to achieve this.
2. Make the rest of the GUI for this procedure (partly done).
3. Game-logic (in-game messages for bullets, enemies, moving doors, and the 4 players)
3.1 Getting the players color right and send position msg to each other
3.2 Get computer enemies working
3.3 Get bullets working
3.4 Get doors working
4. Get game modes working [dogfight] p vs p (I will do 4 maps)
5. Get game modes working [mission] players cooperate to transport cargo
6. Get game modes working [race]  players do not collide
7. Get the rest of the GUI in menu working to present the result of a match.


Begin to download the project either from github (https://github.com/rh-galaxy/galaxyvr/tree/multiplayer) or this link: https://www.galaxy-forces-vr.com/GFVR_multip_dev.zip
Then install UnityHub and go to https://unity3d.com/get-unity/download/archive and select version Unity 2019.2.10f1.
Here is the game website, with other links https://www.galaxy-forces-vr.com/

---
More explained on the connection procedure.

The connect procedure in the GUI (see image 1: https://www.galaxy-forces-vr.com/temp/unity_multiplayer1.jpg)
The possible ways for connections (see below)

                      PHP Server
                        |
Master  <-> Router <-> Internet <-> Client2
Client1 <|                       |> Router <-> Client3

1. The master create a game (and send its internal and external IP to the PHP server), it also setup port forwarding with Open.Nat (default port 1999)
2. Other clients can see the game and join
3. Joining clients use the IP (first try external, then try internal) and port from the PHP server to connect
4. The joined players see other players in the game (sent from master as a reply whenever the list of players change)
5. The master starts the game - all players in the game begin loading the level selected.

We are now at the start of 4 in the current code

But there are things not working yet like
1. Cancel connection at any time from any computer.
 (joined players shall disappear, if the master cancels joined players shall detect it and cancel)
2. Connect is blocking right now, should be asynchronous.
3. Master - Client1 -- tested working
   Master - Client2 -- not tested
   Master - Client3 -- tested working
   
---   
Currently multi-player code are added to 3 files   

GameManager.cs - Mostly row 617 - 729
Menu.cs - Mostly around row 390 - 442 but some code is spread all over
SendRecv.cs - All of this file.
 UpdateJoin() is called periodically to get available games from the PHP server
 UpdateCreate() is called periodically after the Master has created a game to announce to the PHP server that the game is still open and waiting for players
   The first time this is called port forwarding is set up with Open.Nat.
 Messages sent on the network are defined as a struct, currently GameJoin, GameInfo, and GameStart. And every message shall begin with the size (one byte outside of the struct).
  getBytes() and fromBytes() can be used to convert a struct to/from a byte array before sending.








Non-multi-player todo.txt

-------
Release
- Trailer: Seems only 30fps is shown not 60 (need fix by Oculus)
Release for Oculus Quest
- Get the concept approved by Oculus (currently denied)

-------
Known issues/small things undone
- Maybe have a "remove bullet"-msg in the replay data.
- Maybe have a "door movement"-msg in the replay data.
- Test different textures for the single colored cave edges.
- Test different background textures for the back-plate and borders.
- Windows on the house is not exactly the same height.
- There is no back wall of hangar building. Visible through door.
- Make XBox-controller not be unresponsive after pause and unpause
 (after accessing Virtual Desktop) (Might not be possible, and not a requirement)

Must do:
- Enable code for Oculus entitlement check (done, and keep it done later in Release version)

Possible future extensions
- www.galaxy-forces-vr.com - Better/more contents
- Add more official maps/new tilesets (digital world, ?)
- Add achievements for the extra official maps

-------
Achievements: (implemented for steam and oculus)
- Survivor - Finish a mission level without damage [normal unlock]                     Survivor
- Hellbent - Finish the same level 8 times in a row [normal unlock]                    Hellbent
- Speedster - Full throttle from start to finish in a race [normal unlock]             Speedster
- Cargo beginner - Finish mission level 00 [normal unlock]                             Cargo1
- Cargo apprentice - Finish mission level 03 [normal unlock]                           Cargo2
- Cargo expert - Finish mission level 06 with no life lost [normal unlock]             Cargo3
- Cargo master - Finish mission level 09 with no damage [normal unlock]                Cargo4
- Race beginner - Finish race level 00 in under 3 minutes [normal unlock]              Race1
- Race apprentice - Finish race level 03 in under 3 minutes [normal unlock]            Race2
- Race expert - Finish race level 06 in under 60 seconds [normal unlock]               Race3
- Race master - Finish race level 10 in under 104 seconds [normal unlock]              Race4
- Fuel burner - Burn 20 minutes worth of fuel [counter unlock]                         Fuelburner
- Ravager - Destroy 100 enemies [counter unlock]                                       Ravager
- Kamikaze - Destroy your ship 100 times [counter unlock]                              Doom
- Racer - Finish 12 race levels [counter unlock]                                       Racer
- Transporter - Finish 12 mission levels [counter unlock]                              Loader
- Trigger - Fire a thousand bullets [counter unlock]                                   Trigger
- Ruler of the Galaxy - Finish each of the 55 levels [bitfield unlock]                 Galaxy55
- The answer is 42 - Travel 42 kilometers [counter unlock]                             Hitchhiker42
- Race overachiever - Finish all races with gold score [normal unlock]                 RaceGold25
- Cargo overachiever - Finish all missions with gold score [normal unlock]             CargoGold30
- User Levels - Finish a user made level 20 times [counter unlock]                     UserLevels